# Script: detect_malware.py
# Description: Scans WordPress files for suspicious PHP code.

import os
import re

# Directory to scan
wordpress_dir = "/var/www/html"

# Common malicious patterns
malicious_patterns = [
    r"base64_decode",
    r"eval\(",
    r"shell_exec",
    r"passthru",
    r"exec"
]

print("Scanning for malware...")

for root, _, files in os.walk(wordpress_dir):
    for file in files:
        if file.endswith(".php"):
            filepath = os.path.join(root, file)
            with open(filepath, "r", encoding="utf-8", errors="ignore") as f:
                content = f.read()
                for pattern in malicious_patterns:
                    if re.search(pattern, content):
                        print(f"WARNING: Potential malware in {filepath}")
